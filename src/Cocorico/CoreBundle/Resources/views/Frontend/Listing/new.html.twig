{% extends '::base.html.twig' %}

{% trans_default_domain 'cocorico_listing' %}

{%- block meta_title -%}
    {{ 'listing.new.meta_title'|trans({}, 'cocorico_meta') ~ " - " ~ cocorico_site_name }}
{%- endblock -%}

{%- block meta_description -%}
    {{ 'listing.new.meta_desc'|trans({}, 'cocorico_meta') }}
{%- endblock -%}

{% block stylesheets %}
    {{ parent() }}

    <style>
        #map-listing {
            width: {{ listing_new_map_w }}%;
            height: {{ listing_new_map_h }}px;
        }
    </style>
{% endblock %}

{% block layout %}
    {% embed '@CocoricoCore/Frontend/layout.html.twig' %}

{% trans_default_domain 'cocorico_listing' %}

{% block breadcrumbs %}{% endblock %}

{% block main %}
<div class="col-xs-12">

    {{ form_start(form, {'attr': {'class': 'form'}}) }}
    <div class="listing-section container">
        <fieldset>
            <!-- alert -->
            <div class="row">
                <div class="col-sm-7">
                    <div class="head">
                        <h2 class="itou-formtitle">Présentez votre offre</h2>
                    </div>
                    <br />
                    <div class="itou-info">
                        <p>Faites connaitre l’étendue de votre savoir faire en présentant aux acheteurs plusieurs offres de prestation avec leurs spécificités .</p>
                    </div>

                {{ form_errors(form) }}

                {% include 'CocoricoCoreBundle:Frontend/Common:_flash.html.twig' %}
                </div>
            </div>

            <div class="row">
                <div class="col-sm-7">
                    <div class="itou-fieldgroup">
                            <legend>TITRE DE L'OFFRE</legend>
                            <div class="field-holder">
                                {{ dump(form.translations) }}
                                {{ form_widget(form.translations.fr.title, {
                                    'attr': {
                                        'class': 'form-control required'
                                    }})
                                }}
                            </div>
                            <legend>Type de prestation</legend>
                            <legend>Catégorie de l'offre de prestation</legend>
                                {{ render(controller('CocoricoCoreBundle:Frontend/ListingCategories:categoriesForm', {'listing': listing})) }}
                            <legend>Présentation de l'offre de prestation (max 250 caractères)</legend>
                                {{ form_widget(form.translations.fr.description, {
                                    'attr': {
                                        'class': 'form-control required'
                                    }})
                                }}
                    </div>
                </div>
                <div class="col-sm-5">
                    <div class="itou-info">
                        <img class="shape" src="/images/info_shape.png" />
                        <p>
                        Le titre de l’offre est la première information que les acheteurs verront. Il faut être clair et concis !
                        </p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-7">
                    <div class="itou-fieldgroup">
                        <legend>Ajouter des photos de la prestation</legend>
                        <div class="area">
                            <div class="uploader">
                                <div id="images-new">
                                    {{ form_errors(form.image.new) }}
                                    {{ form_widget(form.image.new) }}

                                    {{ form_errors(form.image.uploaded) }}
                                    {{ form_widget(form.image.uploaded ) }}
                                </div>
                            </div>
                            {#
                            <div class="detail">
                                <p>{{ 'listing_edit.photos.details'|trans }}</p>
                            </div>
                            <div style="clear:both"></div>
                            <div id="drop-zone">
                                {{ 'listing.drop.files'|trans }}
                            </div>
                            <h3>{{ 'listing.images.to_upload.title'|trans }}</h3>
                            #}
                            <ul id="files-to-upload" class="images-list"></ul>
                        </div>

                    </div>
                </div>
            </div>

            <!-- legacy form -->
            <div class="holder">


                <div class="row">
                    <div class="file-selection">

                        <!-- files-list -->
                        <div class="files-list">
                            <ul class="images-list">
                                {% for image in listing.images %}
                                    <li>
                                        <img src="{{ image.getWebPath | imagine_filter('listing_xsmall') }}"
                                             alt=""/>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-inquiry">
                        <div class="columns-holder">
                            <div class="column" id="listing-location">
                                <h2>{{ 'listing.new.address.title'|trans }}</h2>

                                <p class="error"></p>
                                {{ form_errors(form.location.coordinate) }}
                                {{ form_widget(form.location.coordinate) }}

                                <div class="field-row">
                                    {{ form_errors(form.location.country) }}
                                    <span class="label">{{ form_label(form.location.country) }}</span>

                                    <div class="select-holder">
                                        {{ form_widget(form.location.country, {
                                            'attr': {
                                                'class': "no-arrow"
                                            }
                                        }) }}
                                    </div>
                                </div>
                                <div class="field-row">
                                    <div class="col location">
                                        {{ form_errors(form.location.city) }}
                                        <span class="label">{{ form_label(form.location.city) }}</span>

                                        <div class="field-holder">
                                            {{ form_widget(form.location.city, {
                                                'attr': {
                                                    'class': "form-control"
                                                }
                                            }) }}
                                        </div>
                                    </div>
                                    <div class="col postel-code">
                                        {{ form_errors(form.location.zip) }}
                                        <span class="label">{{ form_label(form.location.zip) }}</span>

                                        <div class="field-holder">
                                            {{ form_widget(form.location.zip, {
                                                'attr': {
                                                    'class': "form-control"
                                                }
                                            }) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="field-row">
                                    <div class="col cell">
                                        {{ form_errors(form.location.street_number) }}
                                        <span class="label">
                                        {{ form_label(form.location.street_number) }}
                                        <button title="{{ 'listing.location.help'|trans }}"
                                                data-placement="right"
                                                data-toggle="tooltip" class="tooltip-button"
                                                type="button"
                                                data-original-title="{{ 'listing.location.help'|trans }}">
                                            ?
                                        </button>
                                    </span>


                                        <div class="field-holder">
                                            {{ form_widget(form.location.street_number, {
                                                'attr': {
                                                    'class': "form-control"
                                                }
                                            }) }}
                                        </div>
                                    </div>

                                    <div class="col street">
                                        {{ form_errors(form.location.route) }}
                                        <span class="label">{{ form_label(form.location.route) }}</span>

                                        <div class="field-holder">
                                            {{ form_widget(form.location.route, {
                                                'attr': {
                                                    'class': "form-control"
                                                }
                                            }) }}
                                        </div>
                                    </div>
                                </div>

                                <p>
                                    <a class="validate-location" href="javascript:void(0)">
                                        {{ 'listing.location.validate'|trans }}
                                    </a>
                                </p>

                                <p>
                                    <label> {{ 'listing.location.address_found'|trans }}</label>
                                    <strong id="formatted-address">{{ 'listing.location.none'|trans }}</strong>
                                </p>

                                <div class="alert alert-info" role="alert">
                                    <i class="ico arrow"></i>

                                    <p>{{ 'listing.location.drag_message'|trans }}</p>
                                </div>
                            </div>

                            <div class="column">
                                <div class="alert alert-success" role="alert">
                                    <i class="ico"><i class="icon-location"></i></i>

                                    <p>{{ 'listing.location.private_message'|trans }}</p>
                                </div>
                                <div id="map-listing" class="map-box"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="block column">
                        <h2>Autres données</h2>
                        <div class="row">
                            <div class="col-sm-3">
                                <span class="label" style="width:10rem">
                                    Plages horaires de la prestation :
                                </span>
                            </div>
                            <div class="col-sm-6">
                                <ul style="list-style-type:none">
                                    <li>
                                    {{ form_widget(form.schedule_business_hours) }}
                                    {{ form_label(form.schedule_business_hours) }}
                                    </li>
                                    <li>
                                    {{ form_widget(form.schedule_before_opening) }}
                                    {{ form_label(form.schedule_before_opening) }}
                                    </li>
                                    <li>
                                    {{ form_widget(form.schedule_after_closing) }}
                                    {{ form_label(form.schedule_after_closing) }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="row">
                            {{ form_errors(form.range) }}
                            <div class="col-sm-3">
                                <span class="label" style="width:10rem">
                                    {{ form_label(form.range) }}
                                    <button title="{{ 'listing.edit.range.help'|trans }}"
                                            data-placement="right"
                                            data-toggle="tooltip" class="tooltip-button"
                                            type="button"
                                            data-original-title="{{ 'listing.edit.range.help'|trans }}">
                                        ?
                                    </button>
                                </span>
                            </div>
                            <div class="col-sm-6">
                                <div class="field-holder" style="width:8rem;display:inline-block">
                                {{ form_widget(form.range, {
                                    'attr': {
                                        'class': 'numbers-only form-control',
                                    }
                                }) }}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            {{ form_errors(form.url) }}
                            <div class="col-sm-3">
                                <span class="label" style="width:10rem">
                                    {{ form_label(form.url) }} :
                                    <button title="{{ 'listing.edit.url.help'|trans }}"
                                            data-placement="right"
                                            data-toggle="tooltip" class="tooltip-button"
                                            type="button"
                                            data-original-title="{{ 'listing.edit.url.help'|trans }}">
                                        ?
                                    </button>
                                </span>
                            </div>
                            <div class="col-sm-6">
                                <div class="field-holder" style="width:28rem;display:inline-block">
                                {{ form_widget(form.url, {
                                    'attr': {
                                        'class': 'form-control',
                                    }
                                }) }}
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>

    <div class="btns-area new-listing">
        {{ form_errors(form.tac) }}
        <div class="agreement">
            {{ form_widget(form.tac) }}
            <span class="label">
                {{ form_label(form.tac, null, {'required': false} ) }}
                <a href="{{ path('cocorico_page_show', { 'slug': 'nav.tac.slug'|trans }) }}"
                   target="_blank">
                    {{ 'listing.new.tac.link'|trans }}
                </a>*
            </span>
        </div>

        <div id="progress" class="progress">
            <div class="progress-bar progress-bar-success"></div>
        </div>

        <div class="text-center">
            <input id="listing-new-save" type="submit" class="btn btn-primary"
                   value="{{ 'listing.new.save'|trans }}">
        </div>

    </div>
    {{ form_end(form) }}
</div>

{% endblock %}

    {% endembed %}
{% endblock layout %}


{% block javascripts %}
    {{ parent() }}

    {#Geocoding #}
    {% include '@CocoricoCore/Frontend/Listing/js/_geocoding_js.html.twig' with {
        'map_elt': '#map-listing',
        'marker_draggable': true
    } only %}


    <script>
        $(function () {
            {#Currency conversion#}
            currencyConversionHandler('#convert_amount_one', '#convert_amount_two', '#convert_currency_two');

            //Disable submit button on click
            $("[type=submit]").click(function (e) {
                $(this).prop('disabled', true);
            });
        });
    </script>

    {#Translations#}
    {% include '@CocoricoCore/Frontend/Listing/js/_translator_js.html.twig' only %}


    {#Files upload#}
    {% include '@CocoricoCore/Frontend/Common/js/_upload_js.html.twig' with {
        'upload_elt': '#listing_image_new',
        'upload_images': '#listing_image_uploaded',
        'upload_url': oneup_uploader_endpoint('listing_images') ~ "?listing_id=0" ,
        'upload_max': listing_img_max - listing.images.count,
    } only %}

{% endblock %}
